<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Carousel with Pop-out</title>
    <style>
        body {
            height: 100vh;
            width: 100vw;
            background-color: black;
            margin: 0rem;
            overflow: hidden;
        }

        #tiles {
            height: 100vh;
            width: 100vw;
            display: grid;
            grid-template-columns: repeat(var(--columns), 1fr);
            grid-template-rows: repeat(var(--rows), 1fr);
        }

        .tile {
            outline: 1px solid white;
            cursor: pointer;
        }

        #image-track > .image {
            width: 40vmin;
            height: 56vmin;
            object-fit: cover;
            object-position: center;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        #image-track > .image:hover {
            transform: scale(1.05);
        }

        #image-track {
            display: flex;
            gap: 4vmin;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(0%, -50%);
        }

        /* Pop-out overlay styles */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .popup-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .popup-image {
            max-width: 90vw;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 10px;
            z-index: 999;
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.2);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .popup-overlay.active .popup-image {
            transform: scale(1);
        }

        .close-button {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 40px;
            color: white;
            cursor: pointer;
            z-index: 1001;
            transition: color 0.3s ease;
        }

        .close-button:hover {
            color: #ff6b6b;
        }
        @font-face {
    font-family: myFont;
    src: url('delta.ttf') format('truetype');
}
        h1 {
    font-family: myFont;
    color: white;
    text-align: center;
    margin-top: 20px;
    font-size: 2.5rem;
    z-index: 900;
    position: relative;
}
         .page-title {
            position: absolute;
            top: 5%;
            left: 0%;
            width: 100vw;
            text-align: center;
            color: white;
            font-family: myFont;
            font-size: 3.0rem;
            z-index: 1100;
            pointer-events: none; /* prevents interference with tiles */
        }
    </style>
</head>
<body>
    <h1 class="page-title"> Yubitani Photo And Art Gallery</h1>
    <div id="tiles"></div>

    <!-- Image Carousel -->
    <div id="image-track" data-mouse-down-at="0" data-prev-percentage="0">
        <img class="image" src="assets/mangadrawing.jpeg" draggable="false" />
        <img class="image" src="assets/1scroll.JPG" draggable="false" />
        <img class="image" src="assets/2scroll.jpg" draggable="false" />
        <img class="image" src="assets/3scroll.JPG" draggable="false" />
        <img class="image" src="assets/cartoon.jpg" draggable="false" />
        <img class="image" src="https://i.pinimg.com/1200x/2d/a4/b5/2da4b5a8f86ab813f67d25281da80260.jpg" draggable="false" />
        <img class="image" src="assets/6scroll.JPG" draggable="false" />
        <img class="image" src="assets/pretty.jpeg" draggable="false" />
    </div>

    <!-- Pop-out overlay -->
    <div class="popup-overlay" id="popup-overlay">
        <span class="close-button" id="close-button">&times;</span>
        <img class="popup-image" id="popup-image" src="" alt="Pop-out image" />
    </div>
    
    <!-- Include anime.js from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script>
        // Entire scrolling effect
        const track = document.getElementById("image-track");
        let isMouseDown = false;

        window.onmousedown = e => {
            track.dataset.mouseDownAt = e.clientX;
            isMouseDown = true;
        }

        window.onmouseup = () => {
            track.dataset.mouseDownAt = "0";
            track.dataset.prevPercentage = track.dataset.percentage;
            isMouseDown = false;
        }

        window.onmousemove = e => {
            if(track.dataset.mouseDownAt === "0") return;

            const mouseDelta = parseFloat(track.dataset.mouseDownAt) - e.clientX,
                maxDelta = window.innerWidth / 2;

            const percentage = (mouseDelta / maxDelta) * -100;
            let nextPercentage = parseFloat(track.dataset.prevPercentage) + percentage;
           
            nextPercentage = Math.min(nextPercentage, 0);
            nextPercentage = Math.max(nextPercentage, -100);

            track.dataset.percentage = nextPercentage;

            track.animate({
                transform: `translate(${nextPercentage}%, -50%)`
            }, { duration: 1200, fill: "forwards"});

            for(const image of track.getElementsByClassName("image")){
                image.animate({
                    objectPosition: `${100 + nextPercentage}% center`
                }, { duration: 1200, fill: "forwards"});
            }
        }
        // End of scrolling effect

        // Image pop-out functionality
        const popupOverlay = document.getElementById("popup-overlay");
        const popupImage = document.getElementById("popup-image");
        const closeButton = document.getElementById("close-button");

        // Add click event to all images
        document.querySelectorAll('.image').forEach(image => {
            image.addEventListener('click', (e) => {
                // Only trigger if not dragging
                if (!isMouseDown) {
                    popupImage.src = image.src;
                    popupOverlay.classList.add('active');
                    
                    // Animate the popup with anime.js
                    anime({
                        targets: '.popup-image',
                        scale: [0.8, 1],
                        duration: 300,
                        easing: 'easeOutBack'
                    });
                }
            });
        });

        // Close popup functionality
        const closePopup = () => {
            anime({
                targets: '.popup-image',
                scale: [1, 0.8],
                duration: 200,
                easing: 'easeInBack',
                complete: () => {
                    popupOverlay.classList.remove('active');
                }
            });
        };

        closeButton.addEventListener('click', closePopup);
        popupOverlay.addEventListener('click', (e) => {
            if (e.target === popupOverlay) {
                closePopup();
            }
        });

        // Close on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && popupOverlay.classList.contains('active')) {
                closePopup();
            }
        });

        // Entire tile effect
        const wrapper = document.getElementById("tiles");

        let columns = 0;
        let rows = 0;

        const colors = [
            "rgb(229, 57, 53)",
            "rgb(253,216,53)",
            "rgb(244,81,30)",
            "rgb(76,175, 80)",
            "rgb(33,150,243)",
            "rgb(156,39,176)",
        ];

        let count = -1;

        const handleonClick = index => {
            count = count + 1;

            anime({
                targets: ".tile",
                backgroundColor: colors[count % colors.length],
                duration: 300,
                easing: 'easeInOutQuad',
                delay: anime.stagger(40, {
                    grid: [columns, rows],
                    from: index
                })
            });
        }

        const createTile = index => {
            const tile = document.createElement("div");
            tile.classList.add("tile");
            tile.onclick = e => handleonClick(index);
            return tile;
        }

        const createTiles = quantity => {
            Array.from(Array(quantity)).map((tile, index) => {
                wrapper.appendChild(createTile(index));
            })
        }

        const createGrid = () => {
            wrapper.innerHTML = "";

            columns = Math.floor(document.body.clientWidth / 50);
            rows = Math.floor(document.body.clientHeight / 50);

            wrapper.style.setProperty("--columns", columns);
            wrapper.style.setProperty("--rows", rows);

            createTiles(columns * rows);
        }

        createGrid();

        window.onresize = () => createGrid();
    </script>
</body>
</html>